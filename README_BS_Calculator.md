# Torn City BS 预测计算器

这是一个独立的Python程序，用于计算Torn City玩家的Battle Stats (BS)值。

## 功能特点

- 🎯 **精确计算**: 基于完整的BS预测算法
- 📊 **详细分析**: 显示能量计算、健身房模拟、Rank修正等所有步骤
- 🔍 **调试友好**: 提供详细的计算过程输出
- ⚡ **高效API**: 直接调用Torn API获取最新数据
- 🏆 **可信度评估**: 根据数据质量评估预测准确性

## 安装要求

```bash
pip install requests
```

## 使用方法

### 基本使用

```bash
python bs_calculator.py --user_id 用户ID --api_key 您的API密钥
```

### 示例

```bash
python bs_calculator.py --user_id 2770166 --api_key your_api_key_here
```

### 参数说明

- `--user_id`: 要计算BS的用户ID（必需）
- `--api_key`: 您的Torn API密钥（必需）
- `--verbose`: 显示更详细的输出（可选）

## 输出示例

```
🎯 开始计算用户 2770166 的BS值
============================================================

📊 获取用户 2770166 的数据...
🌐 API请求: https://api.torn.com/v2/user/2770166?key=***
🌐 API请求: https://api.torn.com/v2/user/2770166/personalstats?cat=all&key=***
✅ 用户数据获取完成
   - 用户名: Nalynavati
   - 等级: 100
   - 年龄: 2500 天
   - Rank: Elite
   - 净资产: $500,000,000

⚡ 开始计算总能量消耗...
   - 账户年龄: 2500 天
   - 捐献天数: 1200 天
   - 捐献者比例: 0.480
   - 每日能量(y): 595.2
   - 活跃度因子(F): 1026.9
   - 离线天数: 0.1
   - 活跃时间估算(N): 2100.5
   - 药物能量: 450.2
   - 犯罪能量: 1200.8
   - 估算活跃天数: 2100.5
   - 自然能量: 1,250,000
   - 道具能量: 250,000
   - 消耗能量: 150,000
   - 总可用能量: 1,350,000

🏋️ 开始模拟健身房锻炼...
   - 初始能量: 1,350,000
   - H值(新公式阈值): 500,000
   - 切换到健身房等级 2
   - 切换到健身房等级 3
   - SE增强剂使用: 50
   - SE加成前: 150,000,000
   - SE加成后: 200,000,000
   - 健身房训练会话: 1500
   - 最终总属性: 200,000,000
   - 剩余能量: 50,000

🎖️ 开始Rank修正...
   - 用户Rank: Elite
   - 初始c值: 25 -> 24
   - 等级: 100, 等级修正: -8
   - 总犯罪次数: 50,000, 犯罪修正: -6
   - 净资产: $500,000,000, 资产修正: -3
   - 最终c值: 7
   - BS范围: [2,000,000 - 35,000,000]
   - 计算属性: 200,000,000
   - 结果高于上限，使用中间值
   - 修正后BS: 117,500,000

🏆 最终计算结果
============================================================
   - 总属性值: 200,000,000
   - 修正后BS: 117,500,000
   - BS分数: 685,994
   - 预测可信度: high

📊 计算完成！
用户: Nalynavati (ID: 2770166)
等级: 100, Rank: Elite
预估BS: 117,500,000
BS分数: 685,994
可信度: high
```

## 算法说明

### 1. 总能量计算
- 基于账户年龄、捐献者状态、活跃度计算自然能量
- 考虑药物使用、道具使用等额外能量来源
- 减去攻击、复活等能量消耗

### 2. 健身房模拟
- 模拟从低级到高级健身房的训练过程
- 应用三种不同的计算公式（旧公式、属性上限、新公式）
- 考虑SE增强剂的加成效果

### 3. Rank修正
- 根据用户Rank、等级、犯罪次数、净资产进行修正
- 确定BS值的合理范围
- 应用必要的上下限调整

### 4. 可信度评估
- **high**: 总能量 > 1,000,000（数据充足，预测准确）
- **medium**: 总能量 > 100,000（数据一般，预测可参考）
- **low**: 总能量 ≤ 100,000（数据不足，预测不准确）

## 注意事项

1. **API限制**: 请确保您的API密钥有足够的请求次数
2. **数据准确性**: 预测结果依赖于API数据的完整性
3. **算法版本**: 基于当前最新的BS计算算法
4. **隐私保护**: 程序不会存储或上传任何用户数据

## 故障排除

### 常见错误

1. **API错误**: 检查API密钥是否正确且有效
2. **网络错误**: 检查网络连接和API服务状态
3. **用户不存在**: 确认用户ID是否正确
4. **权限不足**: 确保API密钥有访问用户数据的权限

### 调试技巧

- 使用`--verbose`参数获取更详细的输出
- 检查每个计算步骤的中间结果
- 对比不同用户的计算结果来验证算法

## 更新日志

- v1.0: 初始版本，包含完整的BS计算算法
- 支持详细的调试输出和错误处理
- 优化了API请求和数据处理逻辑 